<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>약물계산기</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
    }

    .section {
      margin-bottom: 30px;
    }

    .drug-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .drug-button {
      padding: 14px;
      font-size: 17px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
    }

    .blue { background-color: #b3d9ff; color: #003366; }
    .blue.selected { background-color: #3399ff; color: white; }

    .pink { background-color: #f8d7da; color: #721c24; }
    .pink.selected { background-color: #c2185b; color: white; }

    .selected-drug {
      font-size: 18px;
      font-weight: bold;
      color: #333;
      margin-top: 10px;
    }

    .weight-input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    /* 농도 버튼 (회색 배경 + 노란 글씨) */
    #concentrationButtons .dose-button {
      background-color: #cccccc;
      color: #ffd700;
      padding: 12px 20px;
      font-size: 17px;
    }

    #concentrationButtons .dose-button.selected {
      background-color: #555555;
      color: white;
    }

    /* 용량 버튼 (연초록 계열) */
    #doseButtons .dose-button {
      background-color: #e2f0cb;
      color: black;
      padding: 12px 20px;
      font-size: 17px;
    }

    #doseButtons .dose-button.selected {
      background-color: #76c893;
      color: white;
    }

    .dose-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
    }

    .result-box {
      margin-top: 20px;
      padding: 20px;
      background-color: #f7f7f7;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 20px;
      font-weight: bold;
      color: darkred;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>💉 약물계산기</h1>

  <!-- 체중 입력 (맨 위로 이동) -->
  <div class="section">
    <label for="weight">체중 (kg):</label>
    <input type="number" id="weight" class="weight-input" placeholder="예: 70">
  </div>

  <!-- 약물 선택 -->
  <div class="section">
    <div class="drug-buttons">
      <button class="drug-button blue" onclick="selectDrug(this, 'Norepinephrine', [5, 10])">Norepi/Epi</button>
      <button class="drug-button blue" onclick="selectDrug(this, 'Phenylephrine', [100])">Phenyl</button>
      <button class="drug-button blue" onclick="selectDrug(this, 'Dopamine/Dobutamine', [2000])">Dopa/Dobu</button>
      <button class="drug-button blue" onclick="selectDrug(this, 'Nitroglycerin', [250])">NTG</button>
      <button class="drug-button pink" onclick="selectDrug(this, 'Remimazolam', [1, 2])">Byfavo</button>
      <button class="drug-button pink" onclick="selectDrug(this, 'Precedex', [4])">Precedex</button>
    </div>
    <div class="selected-drug" id="selectedDrug">선택한 약물: 없음</div>
  </div>

  <!-- 농도 선택 -->
  <div class="section" id="concentrationSection" style="display: none;">
    <label>농도 선택:</label>
    <div class="dose-buttons" id="concentrationButtons"></div>
  </div>

  <!-- 용량 선택 -->
  <div class="section" id="doseSection" style="display: none;">
    <label>용량 선택:</label>
    <div class="dose-buttons" id="doseButtons"></div>
  </div>

  <!-- 결과 -->
  <div class="section">
    <div class="result-box" id="resultBox">계산 결과가 여기에 표시됩니다.</div>
  </div>

  <script>
    let selectedDrug = null;
    let selectedConcentration = null;
    let selectedDose = null;

    function selectDrug(buttonElement, drugName, concentrations) {
      selectedDrug = drugName;
      selectedConcentration = null;
      selectedDose = null;

      document.querySelectorAll('.drug-button').forEach(btn => btn.classList.remove('selected'));
      buttonElement.classList.add('selected');
      document.getElementById('selectedDrug').textContent = '선택한 약물: ' + drugName;

      const concContainer = document.getElementById('concentrationButtons');
      concContainer.innerHTML = '';
      concentrations.forEach(value => {
        const btn = document.createElement('button');
        let displayUnit = value + ' mcg/ml';
        if (drugName.includes('Remimazolam')) {
          displayUnit = value + 'mg/ml';
        } else if (drugName.includes('Dopamine')) {
          displayUnit = '2mg/ml';
        }
        btn.textContent = displayUnit;
        btn.className = 'dose-button';
        btn.onclick = () => {
          document.querySelectorAll('#concentrationButtons .dose-button').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          selectedConcentration = value;
          generateDoseButtons(drugName);
        };
        concContainer.appendChild(btn);
      });
      document.getElementById('concentrationSection').style.display = 'block';
      document.getElementById('doseSection').style.display = 'none';
    }

    function generateDoseButtons(drugName) {
      const doseContainer = document.getElementById('doseButtons');
      doseContainer.innerHTML = '';
      let doseValues = [];

      if (drugName.includes('Norepi')) {
        for (let i = 1; i <= 10; i++) {
          doseValues.push((i * 0.01).toFixed(2));
        }
      } else if (drugName.includes('Nitro')) {
        doseValues = [0.5, 1, 2];
      } else if (drugName.includes('Phenyl')) {
        for (let i = 1; i <= 10; i++) {
          doseValues.push((i * 0.1).toFixed(1));
        }
      } else if (drugName.includes('Dopamine')) {
        doseValues = [1, 2, 3, 4, 5, 10];
      } else if (drugName.includes('Precedex')) {
        for (let i = 1; i <= 10; i++) {
          doseValues.push((i * 0.1).toFixed(1));
        }
      } else if (drugName.includes('Remimazolam')) {
        doseValues = [6, 7, 8, 9, 10, 11, 12, 1, 2, 0.1, 0.2];
      }

      doseValues.forEach(value => {
        const btn = document.createElement('button');
        btn.textContent = value;
        btn.className = 'dose-button';
        btn.onclick = () => {
          document.querySelectorAll('#doseButtons .dose-button').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          selectedDose = parseFloat(value);
          calculateResult();
        };
        doseContainer.appendChild(btn);
      });

      document.getElementById('doseSection').style.display = 'block';
    }

    function calculateResult() {
      const weight = parseFloat(document.getElementById('weight').value);
      if (!selectedDrug || !selectedConcentration || !selectedDose || isNaN(weight)) {
        document.getElementById('resultBox').textContent = '약물, 농도, 용량, 체중을 모두 입력해주세요.';
        return;
      }

      let resultText = '';
      if (selectedDrug.includes('Remimazolam')) {
        const totalMgHr = weight * selectedDose;
        const mlHr = totalMgHr / selectedConcentration;
        resultText = mlHr.toFixed(2) + ' ml/hr';
      } else if (selectedDrug.includes('Precedex')) {
        const totalMcgHr = weight * selectedDose;
        const mlHr = totalMcgHr / selectedConcentration;
        resultText = mlHr.toFixed(2) + ' ml/hr';
      } else {
        const totalMcgMin = weight * selectedDose;
        const totalMcgHr = totalMcgMin * 60;
        const mlHr = totalMcgHr / selectedConcentration;
        resultText = mlHr.toFixed(2) + ' ml/hr';
      }

      document.getElementById('resultBox').textContent = resultText;
    }
  </script>
</body>
</html>
